<!--
Enhanced version: all rectangles can upload images, compression applied, R/G/B channels via update button in first row, upload indicator via box-shadow, save works.
-->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dark Mode Bezier Layout - Image Processing</title>
<style>
:root{--bg:#0b0f13;--panel:#0f1720;--muted:#94a3b8;--accent:#60a5fa;}
body{margin:0;padding:24px;font-family:Inter,sans-serif;background:linear-gradient(180deg,var(--bg),#061018 120%);color:var(--muted);display:flex;justify-content:center}
.container{max-width:1100px;width:100%}
.card{background:linear-gradient(180deg,var(--panel),#0b1220);border-radius:12px;padding:18px}
.top-wrap{display:flex;justify-content:center;margin:40px 0}
.rect,.node{width:260px;aspect-ratio:3/2;border-radius:12px;background:#1e293b;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;transition:box-shadow 0.3s}
.rect.uploaded,.node.uploaded{box-shadow:0 0 0 4px rgba(96,165,250,0.6)}
.rect img,.node img{width:100%;height:100%;object-fit:cover}
.upload-btn,.trash-btn,.update-btn,.save-btn{position:absolute;border:none;border-radius:4px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;z-index:2}
.upload-btn{top:4px;left:4px;width:28px;height:28px;background:rgba(96,165,250,0.85);color:#fff}
.trash-btn{top:4px;right:4px;width:28px;height:28px;background:rgba(248,113,113,0.85);color:#fff}
.update-btn{top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(250,204,21,0.85);color:#000;padding:6px 12px;border-radius:6px;display:none}
.save-btn{bottom:4px;right:4px;width:28px;height:28px;background:rgba(34,197,94,0.85);color:#fff}
.three-row{position:relative;margin:50px 0}
.row{display:flex;gap:14px;justify-content:space-between}
.bottom-row{margin-top:36px}
.three-row svg{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;overflow:visible}
input[type='file']{display:none}
</style>
</head>
<body>
<div class="container">
<div class="card">
<header><h1 style="color:var(--accent);font-size:16px;margin:0">Image Processing Layout</h1></header>
<section class="top-wrap">
<div id="rootRect" class="rect"><button class="upload-btn">+</button><button class="trash-btn">ðŸ—‘</button><button class="save-btn">ðŸ’¾</button><input type="file" accept="image/*"></div>
</section>
<section class="three-row" id="middleSection">
<svg id="linksSvg" aria-hidden="true"></svg>
<div class="row" id="topRow">
<div class="node" id="top1"><button class="upload-btn">+</button><button class="trash-btn">ðŸ—‘</button><button class="update-btn">Update</button><button class="save-btn">ðŸ’¾</button><input type="file" accept="image/*"></div>
<div class="node" id="top2"><button class="upload-btn">+</button><button class="trash-btn">ðŸ—‘</button><button class="update-btn">Update</button><button class="save-btn">ðŸ’¾</button><input type="file" accept="image/*"></div>
<div class="node" id="top3"><button class="upload-btn">+</button><button class="trash-btn">ðŸ—‘</button><button class="update-btn">Update</button><button class="save-btn">ðŸ’¾</button><input type="file" accept="image/*"></div>
</div>
<div class="row bottom-row" id="bottomRow">
<div class="node" id="bot1"><button class="upload-btn">+</button><button class="trash-btn">ðŸ—‘</button><button class="save-btn">ðŸ’¾</button><input type="file" accept="image/*"></div>
<div class="node" id="bot2"><button class="upload-btn">+</button><button class="trash-btn">ðŸ—‘</button><button class="save-btn">ðŸ’¾</button><input type="file" accept="image/*"></div>
<div class="node" id="bot3"><button class="upload-btn">+</button><button class="trash-btn">ðŸ—‘</button><button class="save-btn">ðŸ’¾</button><input type="file" accept="image/*"></div>
</div>
</section>
</div>
</div>
<script>
(function(){
const svg=document.getElementById('linksSvg');
const allNodes=Array.from(document.querySelectorAll('.rect,.node'));
let compressedImageData=null,originalFile=null;
function centerPoint(el){const rect=el.getBoundingClientRect();const parentRect=svg.getBoundingClientRect();return{x:rect.left+rect.width/2-parentRect.left,y:rect.top+rect.height/2-parentRect.top}}
function makePath(d){const p=document.createElementNS('http://www.w3.org/2000/svg','path');p.setAttribute('d',d);p.setAttribute('fill','none');p.setAttribute('stroke','rgba(96,165,250,0.85)');p.setAttribute('stroke-width','8');p.setAttribute('stroke-linecap','round');p.setAttribute('stroke-linejoin','round');return p}
function draw(){while(svg.firstChild)svg.removeChild(svg.firstChild);const container=document.getElementById('middleSection');const box=container.getBoundingClientRect();svg.setAttribute('width',box.width);svg.setAttribute('height',box.height);svg.style.width=box.width+'px';svg.style.height=box.height+'px';const root=document.getElementById('rootRect');const topNodes=[document.getElementById('top1'),document.getElementById('top2'),document.getElementById('top3')];const botNodes=[document.getElementById('bot1'),document.getElementById('bot2'),document.getElementById('bot3')];const rootRect=root.getBoundingClientRect();const svgRect=svg.getBoundingClientRect();const rootX=(rootRect.left+rootRect.width/2)-svgRect.left;const rootY=(rootRect.top+rootRect.height)-svgRect.top;topNodes.forEach(n=>{const c=centerPoint(n);const startX=rootX;const startY=rootY;const endX=c.x;const endY=c.y-(n.getBoundingClientRect().height/2);const cp1x=startX;const cp1y=startY+Math.max(60,box.height*0.14);const cp2x=endX;const cp2y=endY-Math.max(60,box.height*0.14);const d=`M ${startX},${startY} C ${cp1x},${cp1y} ${cp2x},${cp2y} ${endX},${endY}`;svg.appendChild(makePath(d))});for(let i=0;i<topNodes.length;i++){const topC=centerPoint(topNodes[i]);const botC=centerPoint(botNodes[i]);const startX=topC.x;const startY=topNodes[i].getBoundingClientRect().bottom-svgRect.top;const endX=botC.x;const endY=botNodes[i].getBoundingClientRect().top-svgRect.top;const offset=Math.max(10,(endY-startY)*0.18);const cp1x=startX;const cp1y=startY+offset;const cp2x=endX;const cp2y=endY-offset;const d=`M ${startX},${startY} C ${cp1x},${cp1y} ${cp2x},${cp2y} ${endX},${endY}`;svg.appendChild(makePath(d))}
}
window.addEventListener('load',draw);window.addEventListener('resize',()=>{if(window._drawRaf)cancelAnimationFrame(window._drawRaf);window._drawRaf=requestAnimationFrame(draw)});setTimeout(draw,400);
allNodes.forEach(rect=>{
const input=rect.querySelector('input[type=file]');
const uploadBtn=rect.querySelector('.upload-btn');
const trashBtn=rect.querySelector('.trash-btn');
const saveBtn=rect.querySelector('.save-btn');
const updateBtn=rect.querySelector('.update-btn');
const imgEl=document.createElement('img');
rect.appendChild(imgEl);
uploadBtn?.addEventListener('click',e=>{e.stopPropagation();input.click()});
input?.addEventListener('change',e=>{
const file=e.target.files[0];
if(!file)return;
rect.classList.add('uploaded');
const reader=new FileReader();
reader.onload=ev=>{imgEl.src=ev.target.result};
reader.readAsDataURL(file);
imgEl.onload=()=>{
const canvas=document.createElement('canvas');
const ctx=canvas.getContext('2d');
const maxW=200;
const scale=Math.min(maxW/imgEl.naturalWidth,maxW/imgEl.naturalHeight,1);
canvas.width=imgEl.naturalWidth*scale;canvas.height=imgEl.naturalHeight*scale;
ctx.drawImage(imgEl,0,0,canvas.width,canvas.height);
if(rect.id==='rootRect'){
originalFile=file;
compressedImageData=canvas;
[topNodes[0],topNodes[1],topNodes[2]].forEach(n=>{n.querySelector('.update-btn').style.display='flex'});
imgEl.src=canvas.toDataURL('image/jpeg',0.7);
}else{
imgEl.src=canvas.toDataURL('image/jpeg',0.7);
}
}
});
trashBtn?.addEventListener('click',e=>{
e.stopPropagation();
imgEl.src='';
input.value='';
rect.classList.remove('uploaded');
if(rect.id==='rootRect'){
compressedImageData=null;
originalFile=null;
[topNodes[0],topNodes[1],topNodes[2]].forEach(n=>{n.querySelector('.update-btn').style.display='none'})
}
});
updateBtn?.addEventListener('click',e=>{
e.stopPropagation();
if(!compressedImageData)return;
const idx=[topNodes[0],topNodes[1],topNodes[2]].indexOf(rect);
if(idx===-1)return;
const ctx=compressedImageData.getContext('2d');
const imgData=ctx.getImageData(0,0,compressedImageData.width,compressedImageData.height);
const channelCanvas=document.createElement('canvas');
channelCanvas.width=compressedImageData.width;
channelCanvas.height=compressedImageData.height;
const cctx=channelCanvas.getContext('2d');
const newData=cctx.createImageData(channelCanvas.width,channelCanvas.height);
for(let i=0;i<imgData.data.length;i+=4){const val=imgData.data[i+idx];newData.data[i]=newData.data[i+1]=newData.data[i+2]=val;newData.data[i+3]=255}
cctx.putImageData(newData,0,0);
imgEl.src=channelCanvas.toDataURL();
});
saveBtn?.addEventListener('click',e=>{
e.stopPropagation();
if(!originalFile)return;
let downloadUrl;
if(rect.classList.contains('node')&&[topNodes[0],topNodes[1],topNodes[2]].includes(rect)&&rect.querySelector('img')){
downloadUrl=rect.querySelector('img').src;
}else downloadUrl=URL.createObjectURL(originalFile);
const a=document.createElement('a');
a.href=downloadUrl;
a.download='processed_'+originalFile.name;
a.click();
if(downloadUrl.startsWith('blob:'))URL.revokeObjectURL(downloadUrl);
});
});
})();
</script>
</body>
</html>